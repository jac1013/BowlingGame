<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>
        .button {
            min-width: 100px;
            min-height: 50px;
            background-color: coral;
            active: background-color : red;
        }

        .button:disabled{
            background: #999;
            color: #555;
            cursor: default;
        }

        .button:active {

            -webkit-box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.6);
            -moz-box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.6);
            box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.6);
            background: #2E5481;
            border: solid 1px #203E5F;
            color: white;
        }

        .mainDiv {
            position: relative;
            top: 150px;
            left: 150px;
            width: 710px;
            height: 200px;
            text-align: center;
            border-style: solid;
            border-width: 1px;
        }

        .mainDiv .forOutter {
            position: relative;
            width: 710px;
            height: 60px;

        }

        .mainDiv .forOutter .outter {
            position: relative;
            border-style: solid;
            border-width: 1px;
            border-color: black;
            width: 60px;
            height: 60px;

        }

        .mainDiv .forOutter .outter .rightCornerTop {
            position: relative;
            height: 15px;
            width: 29px;
            background-color: black;
            border-top: white;
        }

        .mainDiv .forOutter .outter .rightCornerTopWhite {
            position: relative;
            height: 15px;
            width: 29px;
            background-color: white;
            border-right: black;

        }

        .mainDiv .forOutter .outter .rightCornerBot {
            position: relative;
            height: 15px;
            width: 29px;
            border-color: white;
            background-color: black;
        }

        .mainDiv .forOutter .outter .rightCorner {
            position: relative;
            left: 30px;
            height: 30px;
            width: 29px;
            background-color: white;
            border-style: solid;
            border-width: 1px;
            border-top: white;
            border-right: white;
            text-align: center;
        }

        .mainDiv .forOutter .outter .firstRollScore {
            position: relative;
            height: 31px;
            width: 30px;
            text-align: center;
        }

        .mainDiv .forOutter .outter .totalScoreContainer {
            position: relative;
            top: -30px;
            height: 28px;
            width: 60px;
            background-color: white;
            text-align: center;
        }


    </style>

    <script src="Game.js"></script>


</head>
<body>
<h1>Bowling Game</h1>
<input type="text" id="pins"> <br>
<button onclick="getInputAndRollIt()" id="button" class="button" disabled = "disabled">Roll it!</button>

<div class="mainDiv">
    <h3>Score</h3>

    <div class="forOutter">


    </div>
</div>
</div>

<script>
    pins = document.getElementById("pins");
    button = document.getElementById("button");
    pins.addEventListener("keydown", pinsListener, false);

    function pinsListener(event){
        var reg = new RegExp("[0-9]");
        if(event.keyCode == 8){
            button.disabled = "disabled";
        }
        if(reg.exec(String.fromCharCode(event.keyCode))){
            var value = parseInt(pins.value + String.fromCharCode(event.keyCode)),
                    to = 10;
            if(!(logic.firstRoll) && logic.rolls[logic.currentRoll-1] != null){
                to = 10 - logic.rolls[logic.currentRoll-1];
                console.log(to);
            }

            if(value <= to && value >= 0){
                button.disabled = "";
            }
            else{
                button.disabled = "disabled";
            }
        }
    }
    g = new Game();
    logic = new LogicalVariables();

    function LogicalVariables() {
        this.firstRoll = true;
        this.rolls = new Array();
        this.currentRoll = 0;
        this.currentFrame = 0;
        this.lastLeftPosition = -60;
        this.lastTopPosition = 82;
        this.frameScore = new Array();
        this.pendingStrikeOrSpareEvents = new Array();
        this.resultContainerWithListener = new Array();
    }

    function getInputAndRollIt() {
        g.roll(pins.value);
        paintRoll();
        pins.removeEventListener("keypress", pinsListener, false);
        pins.addEventListener("keypress", pinsListener, false);
        button.disabled = "disabled";

    }

    function ComponentsContainer() {

        this.outterContainer = (function () {
            return document.querySelector(".mainDiv .forOutter");
        })();

        this.resultContainer = function (leftPosition, topPosition) {
            var div = document.createElement("div");
            div.className = "outter";
            div.style.left = (leftPosition + 70) + "px";
            div.style.top = (topPosition - 62) + "px";
            logic.lastLeftPosition += 70;
            logic.lastTopPosition -= 62
            return div;
        };

        this.totalResultContainer = function (score) {
            var div = document.createElement("div");
            div.className = "totalScoreContainer";
            div.innerHTML += score;
            return div;

        };

        this.rightCorner = (function () {
            var div = document.createElement("div");
            div.className = "rightCorner";
            return div;
        })();


        this.firstResult = function (score) {
            var div = document.createElement("div");
            div.className = "firstRollScore";
            div.innerHTML += score;
            return div;
        };

        this.strikeResult = (function () {
            var div = document.createElement("div"),
                    divStrikeBot = document.createElement("div"),
                    divStrikeTop = document.createElement("div");
            divStrikeTop.className = "rightCornerTop";
            divStrikeBot.className = "rightCornerBot";
            div.className = "rightCorner";
            div.appendChild(divStrikeTop);
            div.appendChild(divStrikeBot);
            return div;

        })();

        this.spareResult = (function () {
            var div = document.createElement("div"),
                    divSpareTop = document.createElement("div"),
                    divSpareBot = document.createElement("div");
            divSpareTop.className = "rightCornerTopWhite";
            divSpareBot.className = "rightCornerBot";
            div.className = "rightCorner";
            div.appendChild(divSpareTop);
            div.appendChild(divSpareBot);

            return div;
        })();

        this.singleSecondResult = function (divToAppendScore, score) {
            divToAppendScore.innerHTML += score;
            return divToAppendScore;
        };

        this.outters = function () {
            return document.querySelectorAll(".outter");
        };

        this.rightCorners = function () {
            return document.querySelectorAll(".rightCorner");
        };


    }

    function paintRoll() {
        var components = new ComponentsContainer(),
                i = 0;



        if (logic.firstRoll) {
            var resultContainer = components.resultContainer(logic.lastLeftPosition, logic.lastTopPosition),
                    outterContainer = components.outterContainer;
            outterContainer.appendChild(resultContainer);
            resultContainer.twoRollsHappen = logic.currentFrame + 3;
            if (pins.value == "10") {
                var strikeResult = components.strikeResult,
                        outters = components.outters(),
                        strikeEvent = document.createEvent("Event");
                outters[logic.currentFrame].appendChild(strikeResult);
                logic.rolls[logic.currentRoll++] = parseInt(pins.value);
                logic.frameScore[logic.currentFrame++] = parseInt(pins.value);
                resultContainer.addEventListener("bonus",function bonus(){
                                if(resultContainer.twoRollsHappen == logic.currentRoll){
                                    var totalScore = components.totalResultContainer(10 + logic.rolls[logic.currentRoll-1]
                                            + logic.rolls[logic.currentRoll-2]);
                                    totalScore.style.top = "0px";
                                    resultContainer.appendChild(totalScore);
                                    resultContainer.removeEventListener("bonus", strikeBonus, false);
                                }
                },false)
                strikeEvent.initEvent("bonus", true, true);
                logic.pendingStrikeOrSpareEvents[logic.currentFrame] = strikeEvent;
                logic.resultContainerWithListener[logic.currentFrame] = resultContainer;

            } else {
                var firstResult = components.firstResult(pins.value),
                        rightCorner = components.rightCorner,
                        outters = components.outters();
                rightCorner.style.top = "-19px";
                outters[logic.currentFrame].appendChild(firstResult).
                        appendChild(rightCorner);
                logic.rolls[logic.currentRoll++] = parseInt(pins.value);
                logic.firstRoll = false;

            }
        } else {

            if (parseInt(pins.value) + logic.rolls[logic.currentRoll - 1] == 10) {
                var spareResult = components.spareResult,
                        oldRightCorner = components.rightCorners()[logic.currentFrame],
                        resultContainer = components.outters()[logic.currentFrame],
                        spareEvent = document.createEvent("Event");
                resultContainer.oneRollHappen = logic.currentRoll +2;
                spareResult.style.top = "-19px";
                oldRightCorner.parentNode.replaceChild(spareResult, oldRightCorner);
                logic.rolls[logic.currentRoll] = parseInt(pins.value);
                logic.frameScore[logic.currentFrame] = 10;
                resultContainer.addEventListener("bonus",function bonus(){
                    if(resultContainer.oneRollHappen == logic.currentRoll){
                        var totalScore = components.totalResultContainer(10 + logic.rolls[logic.currentRoll-1]);
                        totalScore.style.top = "0px";
                        resultContainer.appendChild(totalScore);
                        resultContainer.removeEventListener("bonus", bonus, false);
                    }
                },false);
                spareEvent.initEvent("bonus", true,true);
                logic.resultContainerWithListener[logic.currentFrame] = resultContainer;
                logic.pendingStrikeOrSpareEvents[logic.currentFrame] = spareEvent;
            }else{
                var rightCorner = components.rightCorner,
                        rightCornerWithsecondResult = components.singleSecondResult(rightCorner, pins.value),
                        oldRightCorner = components.rightCorners()[logic.currentFrame],
                        totalScore = components.totalResultContainer(logic.rolls[logic.currentRoll-1] + parseInt(pins.value)),
                        outters = components.outters();
                rightCornerWithsecondResult.style.top = "-19px";
                totalScore.style.top = "0px";
                oldRightCorner.parentNode.replaceChild(rightCornerWithsecondResult, oldRightCorner);
                outters[logic.currentFrame].appendChild(totalScore);
                logic.rolls[logic.currentRoll] = parseInt(pins.value);
                logic.frameScore[logic.currentFrame] = logic.rolls[logic.currentRoll-1] + parseInt(pins.value);


            }

            logic.currentFrame++;
            logic.currentRoll++;
            logic.firstRoll = true;
        }

        for(i = 0; i<logic.pendingStrikeOrSpareEvents.length; i++){
            if(!(logic.resultContainerWithListener[i] == null)){
                logic.resultContainerWithListener[i].dispatchEvent(logic.pendingStrikeOrSpareEvents[i]);
            }
        }
    }


</script>

<script>
    var ca = new ComponentsContainer();

    testPaintResultContainer: (function () {
        var resultContainer = ca.resultContainer(logic.lastLeftPosition, logic.lastTopPosition),
                outterContainer = ca.outterContainer;
        outterContainer.appendChild(resultContainer);
    });

    testPaintFirstResult: (function () {
        var firstResult = ca.firstResult(5),
                outters = ca.outters();
        outters[0].appendChild(firstResult);

    });

    testPaintSingleSecondResult: (function () {
        var rightCorner = ca.rightCorner,
                rightCornerWithsecondResult = ca.singleSecondResult(rightCorner, 4),
                outters = ca.outters();
        outters[0].appendChild(rightCornerWithsecondResult);
    });

    testRepaintRightCorner: (function () {
        var rightCorner = ca.rightCorner,
                rightCornerWithsecondResult = ca.singleSecondResult(rightCorner, 4),
                outters = ca.outters(),
                spareResult = ca.spareResult;
        outters[0].appendChild(rightCornerWithsecondResult).
                replaceChild(spareResult, rightCorner);

    });

    testPaintSpareResult: (function () {
        var spareResult = ca.spareResult,
                outters = ca.outters();
        outters[0].appendChild(spareResult);
    });

    testPaintStrikeResult: (function () {
        var strikeResult = ca.strikeResult,
                outters = ca.outters();
        outters[0].appendChild(strikeResult);
    });

    testPaintSecondResultContainer: (function () {
        var resultContainer = ca.resultContainer(logic.lastLeftPosition, logic.lastTopPosition);
        outterContainer = ca.outterContainer;
        outterContainer.appendChild(resultContainer);
        var firstResult = ca.firstResult(4),
                secondResult = ca.singleSecondResult(ca.rightCorner, 5),
                totalResult = ca.totalResultContainer(9),
                outters = ca.outters();
        outters[1].appendChild(firstResult);
        outters[1].appendChild(secondResult);
        outters[1].appendChild(totalResult);

    });

    testPaintTotalScore: (function () {
        var outters = ca.outters(),
                totalScore = ca.totalResultContainer(9);
        outters[0].appendChild(totalScore);
    });

    testResultListenerForStrike: (function(){
        var resultContainer = ca.resultContainer(logic.lastLeftPosition, logic.lastTopPosition);
        resultContainer.twoRollsHappen = logic.currentFrame;
        resultContainer.addEventListener("strikeBonus",function(){
            if(resultContainer.twoRollsHappen == logic.currentFrame){
                var totalScore = ca.totalResultContainer(20),
                        outterContainer = ca.outterContainer;
                totalScore.style.top = "30px";
                resultContainer.appendChild(totalScore);
                outterContainer.appendChild(resultContainer);
            }
        },false);
        strikeEvent = document.createEvent("Event");
        strikeEvent.initEvent("strikeBonus", true, true);
        resultContainer.dispatchEvent(strikeEvent);
    });

    testValidatePinsValue: (function(){
        pins.addEventListener("keypress", function(event){
                   var reg = new RegExp("[0-9]");
            if(reg.exec(String.fromCharCode(event.keyCode))){
                var value = parseInt(pins.value + String.fromCharCode(event.keyCode));
                console.log(value);
                if(value <= 10 && value >= 0){
                console.log("is a valid number!");
                }
            else{
                console.log("is not a valid number!");
            }
            }
        }, false);
    })();




</script>


</body>
</html>